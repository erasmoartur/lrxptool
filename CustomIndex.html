<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Custom Index</title>
    <script src="./files/d3.v4.min.js"></script>
	<script src="./files/d3-selection-multi.v0.4.min.js"></script>
    <script src="./files/component-utils.js"></script>
    <script src="./files/tooltip-component.js"></script>
	<script src="./files/d3.layout.cloud.js"></script>
    <script src="./files/radviz-component.js"></script>
    <script src="./files/radviz-regular.js"></script>
	<script src="./files/jquery-1.8.2.js"></script>
	<script src="./files/jquery-ui.js"></script>
	<script src="./files/jquery.csv.js"></script>
	<script src="./files/pearson-correlation.js"></script>
	<script src="./files/logistic-regression.js"></script>
	<script src="./files/roc-curve.js"></script>
	<!--<script type="text/javascript" src="./files/MathJax.js?config=TeX-AMS_HTML-full"></script>-->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			"HTML-CSS": {noReflows: false},
			tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
		});
	</script>
	
    <!-- <script src="../radviz-min.js"></script> -->
    <link rel="stylesheet" type="text/css" href="./files/style.css">
		<style>
		body {
				overflow: hidden;
			}
			.item {
				border: 2px solid white;
				background-color: skyblue;
				opacity: 0.8;
				overflow: visible;
				padding: 6px 0;
				white-space: nowrap;
			}
			.container,
			.list-container {
			   
			}
			.radviz{
				width: 49.5%;
				height: 98vh;
				float: left;
				border: 2px solid gray;
				border-radius: 5px;
				background-color: rgb(245,249,249);
				transition: all 0.4s ease-in-out;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.regularRadviz{
				position: relative;
				width: 49.5%;
				float: right;
				height: 98vh;
				top:0px;
				border: 2px solid gray;
				border-radius: 5px;
				background-color: rgb(245,249,249);
				transition: all 0.4s ease-in-out;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.indexRadviz{
				position: absolute;
				width: 49%;
				float: right;
				height: 98vh;
				right: 8px;
				top:-100vh;
				border: 2px solid gray;
				border-radius: 5px;
				background-color: rgb(245,249,249);
				transition: all 0.4s ease-in-out;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			
			#iconbar{
				left: 0px;
				position: absolute;
				padding-top: 2px;
				padding-right: 4px;
				padding-bottom: 2px;
				padding-left: 4px;
				top: 30%;
				background-color: rgb(224,236,238);
				border: 2px solid gray;
				border-radius: 5px;
				height: 264px;
				width: 24px;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);			
			}
			#iconbar:hover{
				background-color: rgb(201,212,214);	
			}
			#iconbar:hover > .input{
				left: 36px;		
			}
			
			#iconbar2{
				right: 0px;
				position: absolute;
				padding-top: 2px;
				padding-right: 4px;
				padding-bottom: 2px;
				padding-left: 4px;
				top: 30%;
				background-color: rgb(224,236,238);
				border: 2px solid gray;
				border-radius: 5px;
				height: 260px;
				width: 24px;
				box-shadow: -3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			
			}
			#iconbar2:hover{
				background-color: rgb(201,212,214);	
			}
			#iconbar2:hover > .input2{
				right: 36px;			
			}
			.list-container {
			   // float: right;
				padding-top: 50px;
			}        
			.list {
			}
			.state {
				font-weight: bold;
				font-size: 1.2em;
			}
			.slider{
				width: 75%;
			}
			.input{
				left: -300px;
				position: absolute;
				padding-top: 2px;
				padding-right: 4px;
				padding-bottom: 2px;
				padding-left: 4px;
				top: -50px;
				font-size: 0.7em;
				background-color: rgb(224,236,238);
				height: 443px;
				width: 200px;
				transition: all 0.4s ease-in-out;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.input2{
				right: -300px;
				position: absolute;
				padding-top: 2px;
				padding-right: 4px;
				padding-bottom: 2px;
				padding-left: 4px;
				float: right;
				top: -100px;
				font-size: 0.7em;
				background-color: rgb(224,236,238);
				height:480px;
				width: 200px;
				transition: all 0.4s ease-in-out;
				box-shadow: -3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
				}
			.attribSearch{
				position: absolute;
				padding-top: 2px;
				padding-right: 4px;
				padding-bottom: 2px;
				padding-left: 4px;
				top: 80px;
				left: 50%;
				font-size: 0.7em;
				background-color: rgb(224,236,238);
				border: 1px solid gray;
				border-radius: 3px;
				height: 500px;
				width: 200px;
				overflow-y: auto;
				overflow-x: hidden;		
			}
			#upperBar{
				position: absolute;
				width: 99%;
				height: 40px;
				border-radius: 6px;
				background-color: rgb(90,100,110);
				border: 2px black;
				font-size: 0.6em;
				text-indent: 10px;
				letter-spacing: 2px;
				color: rgb(245,245,245);
				box-shadow: 0 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			#myUL {
			  list-style-type: none;
			  padding: 0;
			  margin: 0;
			}

			#myUL a {
			  border: 1px solid #ddd;
			  margin-top: -1px; /* Prevent double borders */
			  background-color: #f6f6f6;
			  padding: 4px;
			  text-decoration: none;
			  color: black;
			  display: block
			}
			#myUL li a:hover:not(.header) {
			  background-color: #eee;
			  color: gray;
			}
			#myUL2 {
			  list-style-type: none;
			  padding: 0;
			  margin: 0;
			}

			#myUL2 a {
			  border: 1px solid #ddd;
			  margin-top: -1px; /* Prevent double borders */
			  background-color: #f6f6f6;
			  padding: 4px;
			  text-decoration: none;
			  color: black;
			  display: block;
			}
			#myUL2 li a:hover:not(.header) {
			  background-color: #eee;
			  color: gray;
			}
			#titulo{
				position: absolute;
				background-color: rgb(90,100,110);
				width: 90%;
				Top: 10px;
				height: 40px;
				left:5%;
				border-radius: 5px;
				font-size: 0.6em;
				text-indent: 10px;
				letter-spacing: 2px;
				color: rgb(245,245,245);
				box-shadow: 0 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
				transition: all 0.9s ease-in-out;
			}
			#titulo h1 {
				opacity:0;			
			}
			.button{
				background-color: rgb(90,100,110);
				border: none;
				border-radius: 5px;
				color: rgb(230,230,230);
				padding: 2px 5px;
				text-align: center;
				text-decoration: none;
				display: inline-block;
				font-size: 16px;
				margin: 0px 0px;
				cursor: pointer;
				-webkit-transition-duration: 0.4s; /* Safari */
				transition-duration: 0.4s;
				box-shadow: 0 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.black{
				background-color: rgb(0,0,0);
				width: 105%;
				height: 105vh;
				position: absolute;
				left: -5px;
				top: -5px;
				opacity: 0;
				visibility: hidden;
				transition: all 0.4s ease-in-out;
			}
			.texttooltip{				
				width: 23%;
				height: 14vh;
				position: absolute;
				left: 10%;
				top: 83%;
				opacity: 1;
				border: 2px solid gray;
				border-radius: 5px;
				background-color: rgb(245,249,249);
				visibility: hidden;
				transition: all 0.2s ease-in-out;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.generator{
				width: 0.5%;
				height: 280px;
				position: absolute;
				float: left;
				left: 25%;
				top: 2vh;
				border: 2px solid gray;
				border-radius: 5px;
				background-color: rgb(245,249,249);
				transition: all 0.4s ease-in-out;
				opacity: 1;
				visibility: hidden;
				box-shadow: 3px 3px 8px 0 rgba(0,0,0,0.2), 0 3px 5px 0 rgba(0,0,0,0.19);
			}
			.button:hover{
				background-color: rgb(80,90,90);			
			}
			.button:disabled{
				background-color: rgb(240,244,244);
			}
			.images{
				width:150px;
				position: absolute;
				top:90px; 
				transition: all 0.4s ease-in-out;
			}
			.images:hover{
				transform: scale(1.1);
			}
			.editbox{
				position:absolute;
				top:62px;
				text-align:center;
				background-color: rgb(245,249,249);
				border: 0px solid black;
				box-shadow: 2px 2px 6px 0 rgba(150,150,150,0.5), 0 2px 3px 0 rgba(150,150,150,0.6);
			}
			.editbox:disabled{
				color:  rgb(155,159,159);
				background-color: rgb(225,229,229);
				box-shadow: 2px 2px 6px 0 rgba(150,150,150,0.5), 0 2px 3px 0 rgba(150,150,150,0.6);
			}

    </style>
</head>
<body>
	<div class="regularRadviz">
		<input type="button" class="button" id="generateXML" value="Panorama" style="width:100px;position:fixed;right:1%;bottom:1.5%;"> <!--disabled-->
		<div class="containerRegular"></div>
	</div>
	
	<div id='iradviz' class="indexRadviz">	
		<input type="button" class="button" id="exportDescription" value="Export..." style="width:100px;position:absolute;right:115px;bottom:5px;"> 
		<input type="button" class="button" id="refreshiRad" value="Refresh" style="width:100px;position:absolute;right:1%;bottom:5px;"> 
		<div class="containerIndRadViz"></div>
	</div>
	
	<div id="radvizdiv" class="radviz">
		<input type="button" class="button" id="atSearch" value="Search" style="width: 100px;position:fixed;left:1%;bottom:1.5%;">
		<div class="container" id="container"></div>
		<div class="attribSearch" style="visibility:hidden;">
			<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for attributes.." style="width:96%;font-size:10px;">
			<ul id="myUL">
			</ul>
			<input type="button" id="atSearchClose" value="Close" style="width: 100%;">
		</div>
	</div>
	
	<div id="iconbar">
		<img src="./interface/menubar01.png" style="height:264px;"/>
		<div class="input">
		<fieldset style="width:170px;height:38px; float: left;">
			<legend>CSV file:</legend>
			<input type="file" id="files" style="width:90%;font-size:10px;" name="files[]"/>
		</fieldset>
		
		<fieldset style="width:170px; height:38px;float: left;">
			<legend>Class labels:</legend>
			<form id="labelIndex">
			<select name="atrs" id="selattr" style="width:90%;font-size:10px;">
				<option>Atributos</option>
			</select>
			</form>
		</fieldset>
			
			<fieldset style="width:170px;height:38px;float: left;">		
			<legend>Element size:</legend>
				<div class="slider">
					<input type="range" name="price-min" id="resize" value="15" min="1" max="30" style="width:150px;">
				</div>
			</fieldset>
			<fieldset style="width:170px;height:38px;float: left;">		
			<legend>Opacity:</legend>
				<div class="slider">
					<input type="range" name="transparencySlider" id="trans" value="80" min="1" max="100" style="width:150px;">
				</div>
			</fieldset>
			<fieldset style="width:170px;height:38px;float:left;">		
			<legend>Link strength:</legend>
			<div class="slider">
				<input type="range" name="strengthSlider" id="strengthSlr" value="1" min="0.5" max="3" step="0.1" style="width:150px;">
			</div>
		</fieldset>
			<fieldset style="width:170px;height:38px;float:left;">		
			<legend>Force(collide):</legend>
				<div class="slider">
					<input type="range" name="collisionSlider" id="collision" value="0" min="0" max="1" step="0.01" style="width:150px;">
				</div>
			</fieldset>
		<fieldset style="width:170px;height:105px;float: left;">
		<legend>Enable/Disable:</legend>
			<form action="" id="ibars">
			<input type="checkbox" name="ibars1" value="1" checked>Informations bars<br>
			</form>
			<form action="" id="nborder">
			<input type="checkbox" name="nborder1" value="1" checked>Border of nodes<br>
			</form>
			<form action="" id="dlinks">
			<input type="checkbox" name="linksd" value="1" checked>Links lines (next rendering)<br>
			</form>
			<form action="" id="wcloud">
			<input type="checkbox" name="wordcl" value="1">Word Cloud<br>
			</form>
			<form action="" id="scorr">
			<input type="checkbox" name="scorrvalue" value="1" checked>Correlation between attributes<br>
			</form>
		</fieldset>	
			
		</div>
	</div>
	
	<div id="iconbar2">	
		<img src="./interface/menubar02.png" style="height:250px;"/>
		<div class="input2">
			<fieldset style="width:170px; height:38px;float: left;">	
				<legend>Regression evaluation:</legend>
				 <form action="" id="visKind">
				  <input type="radio" name="visualization" value="tsne" checked> ROC Curve
				  <input type="radio" name="visualization" value="radviz"> RadViz
				</form>
			</fieldset>
			<fieldset style="width:170px; height:86px;float: left;">	
				<legend>Attribute direclty to ROC:</legend>
				<form id="instId">
				<select name="ids" id="selAtt" style="width:167px;font-size:10px;float: left;">
					<option>Index</option>
				</select>
				</form>
				<form id="selectLab" style="padding-top:25px;padding-bottom:25px">
				<select name="lbs" id="selLab" style="width:167px;font-size:10px;float:left;">
					<option>Label</option>
				</select>
				</form>
				<input type="button" id="addidx" value="Add" style="width:50px;top:20px;">
			</fieldset>	
			
			<fieldset style="width:170px; height:38px;float:left;">
			<legend>Curve granularity:</legend>
				<input type="number" id="gran" name="quantity" min="0.0001" max="0.01" step="0.0001" value="0.0001" style="width:115px;">
			</fieldset>
			<fieldset style="width:170px; height:38px;float:left;">
			<legend>LR confidence:</legend>
				<input type="number" id="conf" name="confidence" min="1" max="100" step="1" value="95" style="width:115px;">
			</fieldset>
			<fieldset id="setlab" style="width:170px; height:38px;float: left;">	
				<legend>RadViz Instance Identifier:</legend>
				<form id="instIdent">
				<select name="ids" id="selIdt" style="width:90%;font-size:10px;">
					<option>Instance ID</option>
				</select>
				</form>
			</fieldset>
			<fieldset style="width:170px;height:35px;float: left;">		
			<legend>Element size:</legend>
				<div class="slider">
					<input type="range" name="esize" id="resize_r" value="10" min="0" max="60" style="width:150px;">
				</div>
			</fieldset>
			<fieldset style="width:170px;height:35px;float:left;">		
			<legend>Opacity:</legend>
				<div class="slider">
					<input type="range" name="transparencySlider" id="trans_r" value="80" min="1" max="100" style="width:150px;">
				</div>
			</fieldset>
			<fieldset style="width:170px;height:35px;float:left;">		
			<legend>Force(collide):</legend>
				<div class="slider">
					<input type="range" name="collisionSlider" id="collision_r" value="2" step="0.1" min="0" max="5" style="width:150px;">
				</div>
			</fieldset>
		</div>
	</div>
	<div id="upperBar" class="upperBar">
		<h1>Logistic Regression Explorer</h1>
	</div>
	<div id="texttooltip" class="texttooltip"></div>
	<div id="black" class="black"></div>
	<div id="generator" class="generator">
		<div id="titulo">
		<h1 id="info" style="opacity:1;">How many charts do you want?</h1>
		</div>
		<!-- <img src="./interface/sel_background.png" style="width:300px;position:absolute;"/> -->
		<div id="charts">
		<input type="text" class="editbox" id="chartname1" value="Chart Tittle" style="left:20px;" disabled>
		<input type="text" class="editbox" id="chartname2" value="Chart Tittle" style="left:186px;" disabled>
		<input type="text" class="editbox" id="chartname3" value="Chart Tittle" style="left:352px;" disabled>
		<input type="text" class="editbox" id="chartname4" value="Chart Tittle" style="left:518px;" disabled>
		<img id="chart1" class="images" src="./interface/chart_disabled.png" style="left:20px;opacity:1;"/>
		<img id="chart2" class="images" src="./interface/chart_disabled.png" style="left:186px;"/>
		<img id="chart3" class="images" src="./interface/chart_disabled.png" style="left:352px;"/>
		<img id="chart4" class="images" src="./interface/chart_disabled.png" style="left:518px;"/>
		</div>
		<input type="button" class="button" id="openHTML" value="Open in new window" style="width:200px;position:absolute;left:50%;bottom:5px;transform: translate(-160%, 0);visibility:hidden;" disabled>
		<input type="button" class="button" id="downloadFiles" value="Model file download" style="width:200px;position:absolute;left:50%;bottom:5px;transform: translate(-50%, 0);visibility:hidden;">
		<input type="button" class="button" id="backBT" value="Back" style="width:200px;position:absolute;left:50%;bottom:5px;transform: translate(60%, 0);visibility:hidden;">
		<input type="button" class="button" id="generateBT" value="Next" style="width:100px;position:absolute;right:10%;bottom:5px;" disabled>
		
	</div>
	
	
    <script>
	
	var vis = 0;
	var useBestIDX = true;
	var bestIDX = [];
	var bestACC = [];
	var lastIDX = [];
	var bestACCindex = [];
	var colorScale = [];
	var data;
	var tData;
	var lines = [];
	var auc = [];
	var description = [];
	var dimensions;
	var radvizData;
	var labelSet;
	var labelOut = [];
	var regularData;
	var arrayData;
	var alldim;
	var rocCurve;
	var lbIndex;
	var binLabel = [];
	var radviz;
	var regularRadviz;
	var indexRadviz;
	var cloudLayout;
	var svg;
	var showCloud = false;
	var rocPrecision = 0.0001;
	var confidence = 95;
	var screenRatio = 1;
	var firstRun = true;
	var autoalign = true;
	var autosort = true;
	var showCorr = true;
	var showImage = false;
	var chartsNumber = 0;
	var selectMode = false;
	var drawLinks = true;
	var actualChart = 0;
    var forceStrength = 1;
	var XML = 0;
	var coeffs = [];
	var targets = [];
	var labelForEachChart = [];
	var chart = {labels:[], dimensions:[]};
	
	
	var wordScale=d3.scaleLinear().domain([0,1]).range([5,20,80,160]).clamp(true);
	var wordColor=d3.scaleLinear().range(['#858c6e', '#09ba2c']);
			
	   $(document).ready(function() {
			if(isAPIAvailable()) {
				$('#files').bind('change', handleFileSelect);
			}
		});
	
	var contains = function(needle) {
    // Per spec, the way to identify NaN is that it is not equal to itself
    var findNaN = needle !== needle;
    var indexOf;

    if(!findNaN && typeof Array.prototype.indexOf === 'function') {
        indexOf = Array.prototype.indexOf;
    } else {
        indexOf = function(needle) {
            var i = -1, index = -1;

            for(i = 0; i < this.length; i++) {
                var item = this[i];

                if((findNaN && item !== item) || item === needle) {
                    index = i;
                    break;
                }
            }
            return index;
        };
    }
    return indexOf.call(this, needle) > -1;
	};

		transpose = function(a) {		  
		  var w = a.length ? a.length : 0,						// Calculate the width and height of the Array
			h = a[0] instanceof Array ? a[0].length : 0;
		 
		  if(h === 0 || w === 0) { return []; }			 // In case it is a zero matrix, no transpose routine needed.

		  var i, j, t = [];		  
		  for(i=0; i<h; i++) {			// Loop through every item in the outer array (height)
			t[i] = [];			// Insert a new row (array)
			
			for(j=0; j<w; j++) {			// Loop through every item per item in outer array (width)
			  t[i][j] = a[j][i];			// Save transposed data.
			}
		  }
		  return t;
		};
		
	function myFunction() {
    var input, filter, ul, li, a, i;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
				li[i].style.display = "";
			} else {
				li[i].style.display = "none";

			}
		}
	}
	
	function myFunction2() {
    var input, filter, ul, li, a, i;
    input = document.getElementById("myInput2");
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL2");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
				li[i].style.display = "";
			} else {
				li[i].style.display = "none";

			}
		}
	}
		
	function isAPIAvailable() {
      if (window.File && window.FileReader && window.FileList && window.Blob) {
        return true;
      } else {
        document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
        document.writeln(' - Google Chrome: 13.0 or later<br />');
        document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
        document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
        document.writeln(' - Safari: Not supported<br />');
        document.writeln(' - Opera: Not supported');
        return false;
      }
    }
	
	function binarize(num,val) {
		if (num == val)
			return 1;
		else
			return 0;
	}
	
	function toObject(data, keys, labelnames, size) {
		var i = 0, k = 0,
			obj = null,
			output = [];

		for (i = 0; i < data.length; i++) {
			obj = {};
			obj['elemSize'] = size[i];
			obj['Name'] = labelnames[i];

			for (k = 0; k < keys.length; k++) {
				
				obj[keys[k]] = data[i][k];
			}

			output.push(obj);
		}

		return output;
	}
	
	function download(data, filename, type) {
		var file = new Blob([data], {type: type});
		if (window.navigator.msSaveOrOpenBlob) // IE10+
			window.navigator.msSaveOrOpenBlob(file, filename);
		else { // Others
			var a = document.createElement("a"),
					url = URL.createObjectURL(file);
			a.href = url;
			a.download = filename;
			document.body.appendChild(a);
			a.click();
			setTimeout(function() {
				document.body.removeChild(a);
				window.URL.revokeObjectURL(url);  
			}, 0); 
		}
	};
	
	function balanceCounter(labels){
		var result = [];
		var sum = 0;
		for (i = 0; i < labels.length; i++) {
			result[i] = 0;
			for (j = 0; j < labels[i].length; j++)
				result[i] += labels[i][j];
			sum += result[i];
		}
		for (i = 0; i < labels.length; i++)
			result[i] = result[i]/sum;
		return result;
	
	}
	
	function correlation(data_, p1, p2){					// Function to calc correlation with categorical values or not
		
		var data = [];
		data[0] = data_[p1].slice();
		data[1] = data_[p2].slice();
		p1 = 0;
		p2 = 1;
		var p1Categorical = data[p1].some(isNaN);
		var p2Categorical = data[p2].some(isNaN);
		var _data = [];
		
		if (p1Categorical &&  p2Categorical){				// Transforming the first in random numbers and throw in next case
			var uniquesP2 = data[p2].filter((v, i, a) => a.indexOf(v) === i);
			_data[1] = [];
			for (var j=0;j<uniquesP2.length;j++) {
				for (var i=0;i<data[p2].length;i++){
					if (uniquesP2[j] == data[p2][i])
						_data[1][i] = j;
				}
			}
			p2Categorical = !p2Categorical;
			data[p2] = _data[1];
		}
		if (!p1Categorical &&  p2Categorical){			// Just switching both and throwing in next case
			var aux = p1;
			p1 = p2;
			p2 = aux;
			p1Categorical = !p1Categorical;
			p2Categorical = !p2Categorical;		
		}
		if (p1Categorical &&  !p2Categorical){
			var sum,n,penalty;
			var avg = [];
			penalty = 0;
			var uniques = data[p1].filter((v, i, a) => a.indexOf(v) === i);
			for (var j=0;j<uniques.length;j++) {
				sum = 0;
				n = 0;
				for (var i=0;i<data[p1].length;i++)
					if (uniques[j] == data[p1][i]) {
						sum+= +data[p2][i];
						n++;
						}
				if (contains.call(avg,sum/n))			// Penalty if the average is already present
					penalty += n/data[p1].length;
				avg[j] = sum/n;
			}
			_data[0] = [];
			
			for (var j=0;j<uniques.length;j++) {
				for (var i=0;i<data[p1].length;i++)
					if (uniques[j] == data[p1][i]) _data[0][i] = avg[j];
			}

			_data[1] = data[p2];
			var result_c = getPearsonCorrelation(_data[0],_data[1]);
			if (result_c>penalty)
				return result_c - penalty;
			else
				return 0;
		}
		if (!p1Categorical &&  !p2Categorical){
			_data[0] = data[p1];
			_data[1] = data[p2];		
		}
		return getPearsonCorrelation(_data[0],_data[1]);
	}
	
	function updateList(dimensions){

		var html = '<select name="atrs" id="selattr" style="width:90%;font-size:10px;">';
		var html_ = '<select name="ids" id="selAtt" style="width:167px;font-size:10px;float:left;">';
		var html__ = '<select name="ids" id="selIdt" style="width:167px;font-size:10px;float:left;">';
		var htmls = '';
		html += '<option value=-1>Choose here</option>'
		html_ += '<option value=-1>Choose here</option>'
		html__ += '<option value=-1>Choose here</option>'
			for (var i=0;i<dimensions.length;i++){
				html += '<option value='+i+'>'+dimensions[i].slice(0,24)+'</option>';
				html_ += '<option value='+i+'>'+dimensions[i].slice(0,24)+'</option>';
				html__ += '<option value='+i+'>'+dimensions[i].slice(0,24)+'</option>';
				htmls += '<li id="as'+i+'"><a href=#>'+dimensions[i]+'</a></li>';
				//htmls += '<input type="button" class="myUL" value="'+dimensions[i]+'">';
			
		}
		document.getElementById("labelIndex").innerHTML = html;
		document.getElementById("instId").innerHTML = html_;
		document.getElementById("instIdent").innerHTML = html__;
		document.getElementById("myUL").innerHTML = htmls;
	}
	
	function sparseToDense(data) {			// Convert a sparse matrix in a dense matrix
		var newdata = [];
		
		for (var i=0;i<data.length;i++){
			newdata[i] = new Array(dimensions.length+1).fill(0);		// All values equals zero
			newdata[i][0] = data[i][0];
			newdata[i][dimensions.length+1] = data[i][data[i].length-1];
			for (var j=1;j<data[i].length-1;j++)
				newdata[i][+data[i][j].slice(0,data[i][j].search(":"))+1] = +data[i][j].slice(data[i][j].search(":")+1,data[i][j].length);		
		}
		dimensions.splice(0, 0, "Identifier");
		dimensions.push("Class");
		return newdata;
	
	}
	
	function handleFileSelect(evt) {
      var files = evt.target.files; // FileList object
      var file = files[0];
      printTable(file);
    }
	
    function printTable(file) {
      var reader = new FileReader();
      reader.readAsText(file);
      reader.onload = function(event){
        var csv = event.target.result;
        data = $.csv.toArrays(csv);
		dimensions = data[0];		// Storing dimensions labels
		data.splice(0,1);				// Cutting data (only values now)
		for (var i = 0;i<data.length;i++){			// Test if the matrix is dense or sparse
			if (data[i].length != dimensions.length){
				data = sparseToDense(data);
				break;			
			}		
		}
		
		
		updateList(dimensions);
		regularData = data;
	//	radvizSetup(44);		
		}
	}
	
	// ID search list set up
	function updateIdList(ind)
	{
		var list = document.getElementById("myUL2");
		var html = '';
		for (var i=0;i<data[ind].length;i++){
				html += '<li id="as'+i+'"><a href=#>'+data[ind][i]+'</a></li>';
		}
		list.innerHTML = html;	
	}
	
	// HTML actions
	
	///building a word cloud
	function initWordCloud(data, daName){

		var maxWords = Math.min(data.length, 200);
		var datadata = [];

		for (var i=0;i<maxWords;i++)
			datadata.push({text:data[i].Name,sizes:Math.abs(data[i][daName])});

		// set the dimensions and margins of the graph
		var width = document.getElementById("texttooltip").clientWidth,
			height = document.getElementById("texttooltip").clientHeight;

		// append the svg object to the body of the page
		svg = d3.select("#texttooltip").append("svg")
			.attr("width", width)
			.attr("height", height)
			.attr("id","cloud")
			.append("g")
		// Constructs a new cloud layout instance. It run an algorythm to find the position of words that suits your requirements
		// Wordcloud features that are different from one word to the other must be here 
		cloudLayout = d3.layout.cloud()
			.size([width, height])
			  //.words(myWords.map(function(d) { return {text: d}; }))
			.words(datadata)
			.padding(1)        //space between words
			.rotate(function() { return ~~(Math.random() * 2) * 90; })
			.fontSize(function(d) { return wordScale(d.sizes); })
			.on("end", draw);

		cloudLayout.start();	
	}
	
	// This function takes the output of 'layout' above and draw the words
	// Wordcloud features that are THE SAME from one word to the other can be here
	function draw(words) {
		svg.append("g")
			.attr("transform", "translate(" + cloudLayout.size()[0] / 2 + "," + cloudLayout.size()[1] / 2 + ")")
			.selectAll("text")
			.data(words)
			.enter().append("text")
			.style("font-size", function(d) { return d.size + "px"; })
			//.style("fill", function(d) { return wordColor(Math.random());})
			.style("fill", function(d) { 
				return wordColor(d.sizes);})
			.attr("text-anchor", "middle")
			.style("font-family", "Impact")
			.attr("transform", function(d) {
			return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
			})
			.text(function(d) { 
				return d.text; });
	}	
	
	function showWordCloud(data, daName){
		if (showCloud){
			//removing previous SVG
			if (d3.select('svg#cloud')["_groups"][0][0] != null)
				d3.select('svg#cloud')["_groups"][0][0].remove();	
			//Build the cloud	
			initWordCloud(data, daName);
			//showing the DIV
			document.getElementsByClassName("texttooltip")[0].style.visibility="visible";
		}	
	}
	
	function hideWordCloud(){
	//hinding the DIV
		document.getElementsByClassName("texttooltip")[0].style.visibility="hidden";	
	}
	
	document.getElementById("labelIndex").onchange = function() {
		document.getElementById("generateXML").disabled = false;
		radvizSetup(document.getElementById("selattr").selectedIndex-1);
	}
	
	document.getElementById("instId").onchange = function() {
	//	updateIdList(document.getElementById("idlist").selectedIndex-1);
	//	nextAtt([]);
	}
	
	/*document.getElementById("rad").onchange = function (){
		radviz.updateColors(!document.getElementById("rad")[0].checked);
    }*/
	
	document.getElementById("ibars").onchange = function (){
		radviz.setBarsVisible(document.getElementById("ibars")[0].checked);
    }
	
	document.getElementById("nborder").onchange = function (){
		radviz.setBorderVisible(document.getElementById("nborder")[0].checked);
    }
	
	document.getElementById("scorr").onchange = function (){
		radviz.enableCorr(document.getElementById("scorr")[0].checked);
    }
	
	document.getElementById("dlinks").onchange = function (){
		drawLinks = document.getElementById("dlinks")[0].checked;
    }
	
	document.getElementById("wcloud").onchange = function (){
		showCloud = document.getElementById("wcloud")[0].checked;
    }	
	
	document.getElementById("resize").onchange = function (){
		radviz.config({dotSize:document.getElementById("resize").value});
		radviz.resizeElements(document.getElementById("resize").value);
    }
	
	document.getElementById("trans").onchange = function (){
		radviz.config({elemOpacity:document.getElementById("trans").value*0.01});
		radviz.setTransparency(document.getElementById("trans").value*0.01);
    }
	
	document.getElementById("conf").onchange = function (){
		confidence = document.getElementById("conf").value;
	}
	
	document.getElementById("gran").onchange = function (){
		rocPrecision = Number(document.getElementById("gran").value);
	}
	
	
	document.getElementById("addidx").onclick = function (){
		throwToRoc(document.getElementById("selAtt").selectedIndex-1, document.getElementById("selLab").selectedIndex-1);
	
	}
	
	document.getElementById("atSearchClose").onclick = function (){
		document.getElementsByClassName("attribSearch")[0].style.visibility= document.getElementsByClassName("attribSearch")[0].style.visibility=="visible"?"hidden":"visible";
	}
	
	
	document.getElementById("atSearch").onclick = function (){
		document.getElementsByClassName("attribSearch")[0].style.visibility= document.getElementsByClassName("attribSearch")[0].style.visibility=="visible"?"hidden":"visible";
	}
	
	document.getElementById("visKind").onchange = function (){
		vis = document.getElementById("visKind")[1].checked;
		if (!vis){ // tsne is the chosen one
			document.getElementsByClassName("indexRadviz")[0].style.top = "-100vh";
			document.getElementsByClassName("regularRadviz")[0].style.top = "0px";			
			}else{
			document.getElementsByClassName("indexRadviz")[0].style.top = "8px";
			document.getElementsByClassName("regularRadviz")[0].style.top = "100vh";		
		}
    }
	
	document.getElementById("collision_r").onchange = function (){
		indexRadviz.changeForce(document.getElementById("collision_r").value);
    }
	
	document.getElementById("collision").onchange = function (){
		radviz.changeForce(document.getElementById("collision").value);
    }
	
	document.getElementById("strengthSlr").onchange = function() {
		forceStrength = document.getElementById("strengthSlr").value;
		radviz.changeStrength(forceStrength);
	}
	
	document.getElementById("resize_r").onchange = function (){
		indexRadviz.config({dotSize:document.getElementById("resize_r").value});
		indexRadviz.resizeElements(document.getElementById("resize_r").value);
    }
	
	document.getElementById("trans_r").onchange = function (){
		indexRadviz.setTransparency(document.getElementById("trans_r").value*0.01);
    }
	
	
	document.getElementById("generateXML").onclick = function (){
		document.getElementById("generateBT").style.visibility="visible";
		document.getElementById("black").style.visibility="visible";
		document.getElementById("black").style.opacity=0.7;
		document.getElementById("charts").style.visibility="visible";
		document.getElementById("charts").style.opacity="1";
		document.getElementById("generator").style.visibility="visible";
		document.getElementById("generator").style.opacity=1;
		document.getElementById("generator").style.width='50%';
		document.getElementById("generator").style.height='280px';
		document.getElementById("generator").style.top='2vh';
		document.getElementById("generator").style.left='25%';
		document.getElementById("info").innerHTML = "How many charts do you want?";
		
	}
	
	function colorCalc(labelSet,labelVector,label_index){
		var colorArray = [];
		for (var i=0;i<labelVector.length;i++)
			colorArray.push(labelSet.indexOf(labelVector[i][label_index]));
		return colorArray;	
	};
	
	
	document.getElementById("instIdent").onchange = function() {
		var idxData;
		
		if (useBestIDX){
			idxData = bestIDX.slice();
		} else{		
			idxData = lastIDX.slice();
		}
		
		// Filling the array
		for (var i=0;i<labelSet.length;i++)
			if (idxData[i] == undefined)
				idxData[i] = Array(data.length).fill(0);
				
		idxData = transpose(idxData);
		
		//get selected identifiers
		var selIdent = document.getElementById("selIdt").selectedIndex-1;
		data = transpose(data);
		var names = data[selIdent].slice();
		data = transpose(data);
		var colors = colorCalc(labelSet,data,lbIndex);
		
		idxData = toObject(idxData, labelSet, names, Array(data.length).fill(0.2));
		
		//idxs already made
		var readyIDXs = [];
		for (var i=0;i<bestACC.length;i++){
			if (bestACC[i]>0.5)
				readyIDXs.push(labelSet[i]);
		}
		
		indexRadviz = radvizRegular()				// Updating radviz settings
				.config({
					el: document.querySelector('.containerIndRadViz'),
					dimensions: readyIDXs,
					allDimensions: labelSet,
					colors: colors,
					dbBalance: Array(data.length).fill(1),
					labelSet: labelSet,
					size: screenRatio*550,
					infoPanelSub: screenRatio*340,
					arcwidth1: 5.5*screenRatio,
					arcwidth2: 10*screenRatio,
					dataSize: data.length,
				});
				
		
		indexRadviz.render(idxData, true);
	}
	
	document.getElementById("exportDescription").onclick = function (){
		var exportRadIdx = [];		
		if (description.length>0){  //Testing if there are already created idx
			for (var i=0;i<bestACCindex.length;i++){
				if (bestACCindex[i] != undefined)
					exportRadIdx.push(description[bestACCindex[i]]);
			}
		}
		else
			alert("No models created yet.");
		
		var expDT = toXML_(exportRadIdx);
		download(expDT, 'regressionRadViz.xml', 'text/plain');
	}
	
	document.getElementById("refreshiRad").onclick = function (){
		var idxData;
		
		var selIdent = document.getElementById("selIdt").selectedIndex-1;
		
		if (selIdent < 0)
			alert("You must choose an attribute as a sample identifier in the right control panel.");
		else
		{
		
			if (useBestIDX){
				idxData = bestIDX.slice();
			} else{		
				idxData = lastIDX.slice();
			}
			
			// Filling the array
			for (var i=0;i<labelSet.length;i++)
				if (idxData[i] == undefined)
					idxData[i] = Array(data.length).fill(0);
					
			idxData = transpose(idxData);
			
			//get selected identifiers
			
			data = transpose(data);
			var names = data[selIdent].slice();
			data = transpose(data);
			var colors = colorCalc(labelSet,data,lbIndex);
			
			idxData = toObject(idxData, labelSet, names, Array(data.length).fill(0.2));

			var readyIDXs = [];
			for (var i=0;i<bestACC.length;i++){
				if (bestACC[i]>0.5)
					readyIDXs.push(labelSet[i]);
			}		
			
			indexRadviz.config({dimensions: readyIDXs});
			
			indexRadviz.render(idxData, true);	
		}
	}
	
	document.getElementById("downloadFiles").onclick = function (){
		download(XML, 'regressionData.xml', 'text/plain');
		
		document.getElementById("openHTML").disabled = false;	//enabling for openning the html	
	}
	
	
	document.getElementById("openHTML").onclick = function (){
		window.open('./panorama/panorama.html');
	}
	
	
	
	
	
	//next step selection attributes and labels for the panorama
	document.getElementById("generateBT").onclick = function (){
		if (!showImage){
			if (actualChart == 0){
				document.getElementById("charts").style.opacity=0;
				document.getElementById("charts").style.visibility="hidden";
				document.getElementById("generator").style.height='85px';
				document.getElementById("generator").style.width='90%';
				document.getElementById("generator").style.left='5%';
				actualChart++;
				document.getElementById("info").innerHTML = "Choose the labels and their important attributes to participate in chart number "+actualChart+" ("+document.getElementById("chartname"+actualChart).value+"):";
				document.getElementById("black").style.left='49.7%';
				selectMode = true;
				radviz.selectMode(selectMode);
				showImage = true;
			} else if (actualChart < chartsNumber){
				chart['labels'].push(radviz.getSelLabs());
				chart['dimensions'].push(radviz.getSelDims());
				targets.push(dimensions[lbIndex]);
				coeffs.push(buildCoeefsMatrix(chart));
				labelForEachChart.push(labelSet);
				radviz.unselectAll();
				document.getElementById("black").style.left='49.7%';
				document.getElementById("charts").style.opacity=0;
				document.getElementById("charts").style.visibility="hidden";
				document.getElementById("generator").style.height='85px';
				document.getElementById("generator").style.width='90%';
				document.getElementById("generator").style.left='5%';
				actualChart++;
				document.getElementById("info").innerHTML = "Choose the labels and their important attributes to participate in chart number "+actualChart+" ("+document.getElementById("chartname"+actualChart).value+"):";
				showImage = true;
			} else if (actualChart == chartsNumber){	
				chart['labels'].push(radviz.getSelLabs());
				chart['dimensions'].push(radviz.getSelDims());
				targets.push(dimensions[lbIndex]);
				coeffs.push(buildCoeefsMatrix(chart));
				labelForEachChart.push(labelSet);
				radviz.unselectAll();
				
				XML = toXML(coeffs, chart, labelForEachChart, targets);  //bulding the xml for export the regression
				
				document.getElementById("charts").style.opacity=0;
				document.getElementById("charts").style.visibility="hidden";
				document.getElementById("info").innerHTML = "The multinomial regression is done. What do you want to do?";
				document.getElementById("black").style.left='0%';
				document.getElementById("generator").style.width='70%';
				document.getElementById("generator").style.left='15%';
				document.getElementById("generator").style.top='200px';
				document.getElementById("generator").style.height='100px';
				document.getElementById("generateBT").style.visibility="hidden";
				document.getElementById("backBT").style.visibility="visible";
				document.getElementById("downloadFiles").style.visibility="visible";
				document.getElementById("openHTML").style.visibility="visible";		
			}
		}else{
			// show chart seturp
			document.getElementById("black").style.left='0%';
			document.getElementById("chart"+actualChart).src = './interface/chart_done.png';
			document.getElementById("generateBT").style.visibility="visible";
			document.getElementById("black").style.visibility="visible";
			document.getElementById("black").style.opacity=0.7;
			document.getElementById("charts").style.visibility="visible";
			document.getElementById("charts").style.opacity=1;
			document.getElementById("generator").style.visibility="visible";
			document.getElementById("generator").style.width='50%';
			document.getElementById("generator").style.height='280px';
			document.getElementById("generator").style.top='2vh';
			document.getElementById("generator").style.left='25%';
			document.getElementById("info").innerHTML = "Charts setup:";		
			showImage = false;
		}
			
	};
	
	
	document.getElementById("backBT").onclick = function (){	
		actualChart=0;
		chartsNumber=0;
			document.getElementById("chart1").src = './interface/chart_disabled.png';
			document.getElementById("chart2").src = './interface/chart_disabled.png';
			document.getElementById("chart3").src = './interface/chart_disabled.png';
			document.getElementById("chart4").src = './interface/chart_disabled.png';
			document.getElementById("chartname1").disabled = true;
			document.getElementById("chartname2").disabled = true;
			document.getElementById("chartname3").disabled = true;
			document.getElementById("chartname4").disabled = true;
		document.getElementById("black").style.opacity=0;
		document.getElementById("black").style.visibility="hidden";
		document.getElementById("generator").style.opacity=0;
		document.getElementById("generator").style.visibility="hidden";
		document.getElementById("backBT").style.visibility="hidden";
		document.getElementById("downloadFiles").style.visibility="hidden";
		document.getElementById("openHTML").style.visibility="hidden";	
		selectMode = false;
		radviz.selectMode(selectMode);
	};
	
	function bynaryRegression(selLabel, selDimensions, data){
		var CR = unescape("%0D");
		var LF = unescape("%0A");
		var Tb = unescape("%09");
		var NL = CR + LF;
		var coeffs = [];
		
		// Transforming categorical data into numbers
		for (var i=0;i<data.length;i++)
				if (data[i].some(isNaN))
					data[i] = toNumerical(data[i],data[lbIndex]);
		
		var da = "";
		
		for (var i=0;i<data[0].length;i++){		//Translating data to a String in the format of logistic regression component
			for (var j=0;j<selDimensions.length;j++){
				da += data[dimensions.indexOf(selDimensions[j])][i] + ",";
			}
			da += binLabel[labelSet.indexOf(selLabel)][i] + NL;		
		}
		
		coeffs = Iterate(da, data[0].length, selDimensions.length, 95, 0);
		return coeffs;
	};
	
	/*function buildCoeefsMatrix(chartsData){
		var coeffs = [];
		for (var i=0;i<chartsData.labels.length;i++){  //for each graph
			coeffs[i] = [];
			for (var j=0;j<labelSet.length;j++)  //for each label
				coeffs[i][j] = bynaryRegression(labelSet[j],chartsData.dimensions[i], tData);
		}
		return coeffs;
	};*/
	
	function buildCoeefsMatrix(chartsData){
		var coeffs = [];
		for (var j=0;j<labelSet.length;j++)  //for each label
				coeffs[j] = bynaryRegression(labelSet[j],chartsData.dimensions[chartsData.dimensions.length-1], tData);	
		return coeffs;
	};
	
	
	function toXML(coeffs, chart, labels, targets){
		var xml = '<RegData><level><coeffs>';  //recording the coeffs matrix
		xml += JSON.stringify(coeffs);
		xml  += '</coeffs>';	
		
	    xml += '<chart>';  //recording the charts info
		xml += JSON.stringify(chart);
		xml += '</chart>';
		
		xml += '<labels>';  //recording the charts info
		xml += JSON.stringify(labels);
		xml += '</labels>';
		
		xml += '<targets>';  //recording the charts info
		xml += JSON.stringify(targets);
		xml += '</targets>';
		
		var chartTitles = [];	//recording chart tittles
		for (var i=1;i<chart.dimensions.length+1;i++)
			chartTitles.push(document.getElementById('chartname'+i).value);
		
		xml += '<tittles>';  //recording the charts info
		xml += JSON.stringify(chartTitles);
		xml += '</tittles></level></RegData>';
		
		return xml;
	};
	
	function toXML_(desc){
		var xml = '<RegData><level><coeffs>';  //recording the coeffs matrix
		xml += JSON.stringify(desc);
		xml += '</coeffs></level></RegData>';		
		return xml;
	}
	
		
	// Clicking on the search element
	document.getElementById("myUL").addEventListener("click",function(e) {
		e.target.style.color = e.target.style.color == 'grey'?  'black':'grey';
		radviz.hideNshow(e.target.innerText, e.target.style.color);
    });
	
	
	// mouse hovering the search elements
	document.getElementById("myUL").addEventListener("mouseover",function(e) {
		radviz.highlightElem(e.target.innerText);
    });
	
	
	// Mouse out element search list
	document.getElementById("myUL").addEventListener("mouseout",function(e) {
		radviz.undoHighlight();
    });
	
	// picking charts quantity

	document.getElementById("chart1").addEventListener("mouseover",function(e) {
		if (!selectMode){
			document.getElementById("chart1").src = './interface/chart_enabled.png';
			document.getElementById("chart2").src = './interface/chart_disabled.png';
			document.getElementById("chart3").src = './interface/chart_disabled.png';
			document.getElementById("chart4").src = './interface/chart_disabled.png';
			document.getElementById("chartname1").disabled = false;
			document.getElementById("chartname2").disabled = true;
			document.getElementById("chartname3").disabled = true;
			document.getElementById("chartname4").disabled = true;
			
			
			document.getElementById("generateBT").disabled = false;
			chartsNumber = 1;
			}
    });
	
	
	document.getElementById("chart2").addEventListener("mouseover",function(e) {
		if (!selectMode){
			document.getElementById("chart1").src = './interface/chart_enabled.png';
			document.getElementById("chart2").src = './interface/chart_enabled.png';
			document.getElementById("chart3").src = './interface/chart_disabled.png';
			document.getElementById("chart4").src = './interface/chart_disabled.png';
			document.getElementById("chartname1").disabled = false;
			document.getElementById("chartname2").disabled = false;
			document.getElementById("chartname3").disabled = true;
			document.getElementById("chartname4").disabled = true;
			document.getElementById("generateBT").disabled = false;
			chartsNumber = 2;
			}
    });
	
	document.getElementById("chart3").addEventListener("mouseover",function(e) {
		if (!selectMode){
			document.getElementById("chart1").src = './interface/chart_enabled.png';
			document.getElementById("chart2").src = './interface/chart_enabled.png';
			document.getElementById("chart3").src = './interface/chart_enabled.png';
			document.getElementById("chart4").src = './interface/chart_disabled.png';
			document.getElementById("chartname1").disabled = false;
			document.getElementById("chartname2").disabled = false;
			document.getElementById("chartname3").disabled = false;
			document.getElementById("chartname4").disabled = true;
			document.getElementById("generateBT").disabled = false;
			chartsNumber = 3;
			}
    });
	
	document.getElementById("chart4").addEventListener("mouseover",function(e) {
		if (!selectMode){
			document.getElementById("chart1").src = './interface/chart_enabled.png';
			document.getElementById("chart2").src = './interface/chart_enabled.png';
			document.getElementById("chart3").src = './interface/chart_enabled.png';
			document.getElementById("chart4").src = './interface/chart_enabled.png';
			document.getElementById("chartname1").disabled = false;
			document.getElementById("chartname2").disabled = false;
			document.getElementById("chartname3").disabled = false;
			document.getElementById("chartname4").disabled = false;
			document.getElementById("generateBT").disabled = false;
			chartsNumber = 4;
		}
    });
		
	
	function nextAtt(dim){
		/*
		if (autoalign || dim.length == 0)
			regularRadvizSetup(document.getElementById("selattr").selectedIndex-1,document.getElementById("idlist").selectedIndex-1,dim,0);
		else{		
			var angleTable = regularRadviz.getAngles().slice(0,dim.length);
			regularRadvizSetup(document.getElementById("selattr").selectedIndex-1,document.getElementById("idlist").selectedIndex-1,dim,angleTable);
		}		*/	
	}
	
	function updateLabelList(labelList){
		var list = document.getElementById("selectLab");
		var html = '<select name="lbs" id="selLab" style="width:167px;font-size:10px;float:left;">';
		html += '<option value=-1>Choose here</option>'
			for (var i=0;i<labelList.length;i++)
				html += '<option value='+i+'>'+labelList[i].slice(0,24)+'</option>';
		list.innerHTML = html;
	}
	////
	
	function radvizSetup(label_index){
		// testing if the radviz is already rendered and then delete the previous one
		if (d3.select('svg#rad')["_groups"][0][0] != null){
			d3.select('svg#rad')["_groups"][0][0].remove();
			d3.select('#radviz-tooltip')["_groups"][0][0].remove();
		}		
		
		
		for (var i=0;i<labelOut.length;i++){			// removing unselected labels
			data = data.filter(function(e){
			return e[label_index]!==labelOut[i]});		
		}
		
		tData = data.slice();
		
		lbIndex = label_index;
		tData = transpose(tData);			// Trasnposing the matrix 
		labelSet = tData[label_index].filter((v, i, a) => a.indexOf(v) === i);  // Getting the uniques values of label vector
		updateLabelList(labelSet);												//Updating the label list for directly add
		binLabel = [];
		for(var i=0; i<labelSet.length; i++) {		// Calculating the binary vector for each label
			binLabel.push(tData[label_index].map(function(x) { return binarize(x,labelSet[i]);}));
			bestACC[i] = 0;
		};
		var dbBal = balanceCounter(binLabel);
		var readyData = tData.concat(binLabel);
		var correlationMatrix = [];
		var correlationPairs = [];
		var size = [];
		var weights = [];
		for(var i=0; i<tData.length; i++){
			correlationMatrix[i] = [];
				for(var j=0; j<labelSet.length; j++)	{				
					correlationMatrix[i].push(correlation(readyData,i,j+tData.length));
					weights.push(Math.abs(correlationMatrix[i][j])*dbBal[j]);	
					}
					
				//size.push(correlation(readyData,i,label_index));
				size.push(weights.reduce((a, b) => a + b, 0));				
				weights = [];
			};
			
		for(var i=0; i<tData.length; i++){	
			correlationPairs[i] = [];
			for(var j=0; j<tData.length; j++){
				correlationPairs[i].push(correlation(readyData,i,j));
			}
		}
		
		// Removing the correlations about the chosen target
		correlationPairs.splice(label_index,1); 
		correlationPairs = transpose(correlationPairs);
		correlationPairs.splice(label_index,1); 
		correlationPairs = transpose(correlationPairs);
		
		radvizData = toObject(correlationMatrix,labelSet,dimensions,size);
		radvizData.splice(label_index,1); 			// Removing the label atribute
		
		screenRatio = (document.getElementById("radvizdiv").clientWidth - 118)/550;
		
		radviz = radvizComponent()				// Updating radviz settings
            .config({
                el: document.querySelector('.container'),
                dimensions: labelSet,
				dbBalance: dbBal,
				size: screenRatio*550,
				infoPanelLeft: screenRatio*455,
				infoPanelBot: 1.2*screenRatio*235,
				arcwidth1: 5.5*screenRatio,
				arcwidth2: 10*screenRatio,
				drawLinks: drawLinks,
				cormatrix: correlationPairs,
            });			
			
		radviz.render(radvizData);	
		radviz.selectMode(selectMode);
	//	renderROC();
    }
	
	
	function toNumerical(vector1,vector2){
		var p1Categorical = vector1.some(isNaN);
		var p2Categorical = vector2.some(isNaN);
		var _data = [];
		
		if (p1Categorical &&  p2Categorical){				// Transforming the first in random numbers and throw in next case
			var uniquesP2 = vector2.filter((v, i, a) => a.indexOf(v) === i);
			_data[1] = [];
			for (var j=0;j<uniquesP2.length;j++) {
				for (var i=0;i<vector2.length;i++){
					if (uniquesP2[j] == vector2[i])
						_data[1][i] = j;
				}
			}
			p2Categorical = !p2Categorical;
			vector2 = _data[1];
		}
		if (p1Categorical &&  !p2Categorical){
			var sum,n;
			var avg = [];
			penalty = 0;
			var uniques = vector1.filter((v, i, a) => a.indexOf(v) === i);
			for (var j=0;j<uniques.length;j++) {
				sum = 0;
				n = 0;
				for (var i=0;i<vector1.length;i++)
					if (uniques[j] == vector1[i]) {
						sum+= +vector2[i];
						n++;
						}
				avg[j] = sum/n;
			}
			_data[0] = [];
			
			for (var j=0;j<uniques.length;j++) {
				for (var i=0;i<vector1.length;i++)
					if (uniques[j] == vector1[i]) _data[0][i] = avg[j];
			}

			_data[1] = vector2;
		}
		return _data[0];
	
	};
	
	function newIndex(coeffs, selDimensions){
		var calcIndex = [];
		var sumCoeffs = [];
		var aux = 0;
		
		for (var i=0;i<tData[0].length;i++){		//Sum of coeffs times values
			sumCoeffs.push(0);
			for (var j=0;j<selDimensions.length;j++){
				sumCoeffs[i] += tData[dimensions.indexOf(selDimensions[j])][i]*coeffs[j+1];
			}
			sumCoeffs[i] +=	coeffs[0];		
		}
		for (var i=0;i<tData[0].length;i++)
			calcIndex.push(1/(1+Math.exp(-sumCoeffs[i])));
			
		return calcIndex;	
	};
	
	function getRocDots(calcIndex, binLabel){
		var TP = 0;
		var TN = 0;
		var tpRate = [];
		var tnRate = [];
		var thrld = [];
		var nDots = 0;
		for (var i=0;i<binLabel.length;i++)			//Getting the total of true positives and true negatives
			TP += binLabel[i];
		TN = binLabel.length - TP;
		
		for (var i=-0.01;i<=1.01;i+=rocPrecision){					//Calculating the true positive and true negative rates for each threshold (0.01 as step)
			tpRate.push(0);
			tnRate.push(0);
			thrld.push(0);
			for (var j=0;j<binLabel.length;j++){
				if ((calcIndex[j]>i)&(binLabel[j]==1))
					tpRate[nDots] += 1;	
				if ((calcIndex[j]<i)&(binLabel[j]==0))
					tnRate[nDots] += 1;	
			}
			tpRate[nDots] = tpRate[nDots]/TP;
			tnRate[nDots] = tnRate[nDots]/TN;
			thrld[nDots] = i;
			nDots++;		
		}
		return [tpRate,tnRate,thrld];
	};
	
	function makeLine(dots){
		var line = [];
		var sum = 0;
		
		for (var i=0;i<dots[0].length;i++){
			var dot = {x:0,y:0,threshold:0};
			dot.y = dots[0][i];
			dot.x = 1 - dots[1][i];
			dot.threshold = dots[2][i];
			if (i>0)
				sum += ((dots[0][i]+dots[0][i-1])*(dots[1][i]-dots[1][i-1]))/2;
			line.push(dot);
		//	line.push(1-dots[1][i]);		
		}
		return [line,sum];	
	};
	
	
	function normalizeAtt(values,mustInvert){
		var norm = [];
		var max = Math.max.apply(null, values);
		var min = Math.min.apply(null, values);
		for (var i=0;i<values.length;i++)
			norm.push((values[i]-min)/(max-min));
		
		if (mustInvert)		
			norm = norm.map(function(num) {return 1-num;});
		return norm;
	};
	
	function throwToRoc(selAttribute, selLabel){
		var dots;
		var line;
		var mustInvert = false;
		var normalizedAtt = [];
		if (correlation([tData[selAttribute],binLabel[selLabel]],0,1)<0)
			mustInvert = true;
		normalizedAtt = normalizeAtt(tData[selAttribute],mustInvert);
		var desc = {label:labelSet[selLabel],coeffs:[0],attribs:['None'],lines:['Not applicable.','Attribute rendered directly: '+dimensions[selAttribute]]};
		dots = getRocDots(normalizedAtt, binLabel[selLabel]);
		line = makeLine(dots);
		lines.push(line[0]);
		auc.push(line[1]);
		description.push(desc);
		renderROC(lines, auc, description);		
	};
	
	function doTheRegression(selLabel, selDimensions){
		var CR = unescape("%0D");
		var LF = unescape("%0A");
		var Tb = unescape("%09");
		var NL = CR + LF;
		var coeffs = [];
		var idx = [];
		var dots;
		var line;
		
		// Transforming categorical data into numbers
		for (var i=0;i<tData.length;i++)
				if (tData[i].some(isNaN))
					tData[i] = toNumerical(tData[i],tData[lbIndex]);
		
		var da = "";
		
		for (var i=0;i<tData[0].length;i++){		//Translating data to a String in the format of logistic regression component
			for (var j=0;j<selDimensions.length;j++){
				da += tData[dimensions.indexOf(selDimensions[j])][i] + ",";
			}
			da += binLabel[labelSet.indexOf(selLabel)][i] + NL;		
		}
		
		coeffs = Iterate(da, tData[0].length, selDimensions.length, 95, 0);
		
		var desc = {label:selLabel,coeffs:coeffs[0],attribs:selDimensions,lines:coeffs[1]};
		
		idx = newIndex(coeffs[0], selDimensions);
		dots = getRocDots(idx, binLabel[labelSet.indexOf(selLabel)]);
		line = makeLine(dots);
		lines.push(line[0]);
		auc.push(line[1]);
		description.push(desc);
		
		// Storing the best (and last) IDX per label
		if (line[1]>bestACC[labelSet.indexOf(selLabel)]){
			bestACC[labelSet.indexOf(selLabel)] = line[1];
			bestIDX[labelSet.indexOf(selLabel)] = idx.slice();
			bestACCindex[labelSet.indexOf(selLabel)] = description.length-1;
		}
		lastIDX[labelSet.indexOf(selLabel)] = idx.slice();
		
		renderROC(lines, auc, description);		
	};
	
	function renderROC(data, auc, description){
		if (data.length>1){
			rocCurve.deleteALL();
			d3.select('#radviz-tooltip')["_groups"][0][0].remove();
		}		
		rocCurve = rocCurveComponent()				// Preparing to render curves
			.config({
                el: document.querySelector('.containerRegular'),
				size: screenRatio*700,
				resizeRatio: screenRatio,
            });						
			
		rocCurve.render(data, data.length>1?false:true, auc, description);
	
	
	};
	
	function removeLabel(label){
		labelOut.push(label);
	};
	
	function updateRadViz(){
		radvizSetup(lbIndex);
	};
	
	
	

    </script>




</body></html>
